<html>
<body>
<canvas id="canvas1" width="800" height="600" style="position:absolute; top:0px; left:0px"></canvas>
<div id="div1" style="position:absolute; top:10px; left:850px"></div>
</body>
<script>
let context = document.getElementById("canvas1").getContext("2d");
let fps = 20;

function Mouse()
{	this.x = 0;
	this.y = 0;
	this.pressed = false;
}

let mouse = new Mouse();

document.getElementById("canvas1").addEventListener('mousedown', onMouseDown);
document.getElementById("canvas1").addEventListener('mouseup', onMouseUp);
document.getElementById("canvas1").addEventListener('mousemove', onMouseMove);

function onMouseDown(event)
{	mouse.pressed = true;
	mouse.x = event.clientX;
	mouse.y = event.clientY;

	document.getElementById("div1").innerHTML = "("+mouse.x+","+mouse.y+")";

	if (selectedFigure == -1)
	{	for (let figure = 0; figure < figures.length; figure++)
		{	if (figures[figure].in(mouse.x, mouse.y))
			{	selectedFigure = figure;
				figures[figure].x = mouse.x;
				figures[figure].y = mouse.y;
				break;
			}
		}
	}
}

function onMouseUp(event)
{	mouse.pressed = false;

	if (selectedFigure != -1)
	{	let angle = Math.atan2(figures[selectedFigure].inicialY-figures[selectedFigure].y, figures[selectedFigure].inicialX-figures[selectedFigure].x);
		//figures[selectedFigure].velocityX = (figures[selectedFigure].startX-event.clientX)*Math.cos(angle);
		//figures[selectedFigure].velocityY = (figures[selectedFigure].startY-event.clientY)*Math.cos(angle);
		figures[selectedFigure].velocityX = figures[selectedFigure].velocity*Math.cos(angle);
		figures[selectedFigure].velocityY = figures[selectedFigure].velocity*Math.sin(angle);
		selectedFigure = -1;
	}
}

function onMouseMove(event)
{	if (mouse.pressed)
	{	mouse.x = event.clientX;
		mouse.y = event.clientY;
	}

	if (selectedFigure != -1)
	{	figures[selectedFigure].x = mouse.x;
		figures[selectedFigure].y = mouse.y;
	}
}

function Figure(x, y, width, height, color, velocity)
{	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;
	this.inicialX = x;
	this.inicialY = y;
	this.color = color;
	this.velocity = velocity;
	this.velocityX = 0;
	this.velocityY = 0;
}

Figure.prototype.in = function(x, y)
{	return((x >= this.x) && (x <= this.x+this.width) && (y >= this.y) && (y <= this.y+this.height));
}

Figure.prototype.update = function()
{	if ((Math.abs(this.x-this.inicialX) < this.velocity) && (Math.abs(this.y-this.inicialY) < this.velocity))
	{	this.velocityX = 0;
		this.velocityY = 0;
		this.x = this.inicialX;
		this.y = this.inicialY;
	}
	else
	{	this.x += this.velocityX;
		this.y += this.velocityY;
	}
}

Figure.prototype.draw = function(context)
{	context.fillStyle = this.color;
	context.fillRect(this.x, this.y, this.width, this.height);
}

let figures = [ new Figure(10, 10, 100, 100, "rgb(255,0,0)", 5), new Figure(200, 200, 100, 100, "rgb(0,255,0)", 30) ];
let selectedFigure = -1;

function loop()
{	context.fillStyle = "rgb(0,0,0)";
	context.fillRect(0,0,800,600);

	for (let figure = 0; figure < figures.length; figure++)
	{	figures[figure].update();
		figures[figure].draw(context);
	}
}

let timer = setInterval(loop, 1000/fps);

document.addEventListener('keypress', onKeyPress);

function onKeyPress(event)
{	clearInterval(timer);
}
</script>
</html>

